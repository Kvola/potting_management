<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ====================================================================
         FORMULE (FO) - VUES
         ==================================================================== -->

    <!-- Tree View -->
    <record id="potting_formule_view_tree" model="ir.ui.view">
        <field name="name">potting.formule.tree</field>
        <field name="model">potting.formule</field>
        <field name="arch" type="xml">
            <tree string="Formules" 
                  decoration-info="state == 'draft'" 
                  decoration-success="state == 'paid'"
                  decoration-warning="state == 'partial_paid'" 
                  decoration-primary="state == 'validated'"
                  decoration-muted="state == 'cancelled'"
                  multi_edit="1"
                  sample="1"
                  default_order="date_emission desc">
                <header>
                    <button name="action_validate" type="object" string="Valider" class="btn-primary"/>
                </header>
                <field name="company_id" column_invisible="1"/>
                <field name="currency_id" column_invisible="1"/>
                <field name="name" decoration-bf="1" string="N¬∞ Formule"/>
                <field name="numero_fo1" optional="show" string="N¬∞ FO1"
                       decoration-info="numero_fo1"/>
                <field name="confirmation_vente_id" string="CV associ√©e"/>
                <field name="transit_order_id" optional="show" string="OT"
                       decoration-success="transit_order_id"/>
                <field name="product_type" widget="badge"
                       decoration-info="product_type == 'cacao'"
                       decoration-success="product_type == 'cafe'"/>
                <field name="grade" optional="show" widget="badge"/>
                <field name="date_fo1" widget="date" optional="show" string="Date FO1"/>
                <field name="tonnage" string="Tonnage (T)" sum="Total" 
                       decoration-bf="1" class="text-primary"/>
                <field name="navire" optional="show" string="Navire"
                       decoration-info="navire"/>
                <field name="destination_country_id" optional="show" string="Destination"/>
                <field name="prix_kg" widget="monetary" string="Prix/Kg" optional="hide"/>
                <field name="montant_net" widget="monetary" string="Montant Net" sum="Total"
                       decoration-bf="1" class="text-success"/>
                <field name="total_paye" widget="monetary" string="Pay√©" optional="show"
                       decoration-success="total_paye > 0"/>
                <field name="paiement_progress" widget="progressbar" optional="show" string="Progression"/>
                <field name="avant_vente_paye" widget="boolean_toggle" optional="hide" string="AV"
                       decoration-success="avant_vente_paye"/>
                <field name="apres_vente_paye" widget="boolean_toggle" optional="hide" string="AP"
                       decoration-success="apres_vente_paye"/>
                <field name="state" widget="badge" 
                       decoration-info="state == 'draft'" 
                       decoration-primary="state == 'validated'"
                       decoration-warning="state == 'partial_paid'"
                       decoration-success="state == 'paid'"
                       decoration-muted="state == 'cancelled'"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="potting_formule_view_form" model="ir.ui.view">
        <field name="name">potting.formule.form</field>
        <field name="model">potting.formule</field>
        <field name="arch" type="xml">
            <form string="Formule">
                <header>
                    <button name="action_validate" type="object" string="‚úÖ Valider la formule" 
                            class="btn-primary" invisible="state != 'draft'"
                            confirm="Voulez-vous valider cette formule ? Elle sera pr√™te pour le paiement."/>
                    <button name="action_create_payment_request_avant_vente" type="object" 
                            string="üí≥ Paiement Avant-vente (60%)" 
                            class="btn-success" 
                            invisible="state not in ('validated', 'partial_paid') or avant_vente_paye"/>
                    <button name="action_create_payment_request_apres_vente" type="object" 
                            string="üí≥ Paiement Apr√®s-vente (40%)" 
                            class="btn-success" 
                            invisible="state not in ('validated', 'partial_paid') or not avant_vente_paye or apres_vente_paye"/>
                    <button name="action_mark_avant_vente_paid" type="object" 
                            string="‚úì Marquer AV pay√©" 
                            class="btn-outline-success" 
                            invisible="state not in ('validated', 'partial_paid') or avant_vente_paye"
                            confirm="Confirmer que le paiement avant-vente a √©t√© effectu√© ?"/>
                    <button name="action_mark_apres_vente_paid" type="object" 
                            string="‚úì Marquer AP pay√©" 
                            class="btn-outline-success" 
                            invisible="state not in ('validated', 'partial_paid') or not avant_vente_paye or apres_vente_paye"
                            confirm="Confirmer que le paiement apr√®s-vente a √©t√© effectu√© ?"/>
                    <button name="action_cancel" type="object" string="‚ùå Annuler" 
                            class="btn-outline-danger"
                            invisible="state in ('cancelled', 'paid')"
                            confirm="Voulez-vous vraiment annuler cette formule ?"/>
                    <button name="action_draft" type="object" string="‚Ü©Ô∏è Brouillon" 
                            invisible="state != 'cancelled'"
                            groups="potting_management.group_potting_manager"/>
                    <field name="state" widget="statusbar" 
                           statusbar_visible="draft,validated,partial_paid,paid"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_transit_order" type="object" 
                                class="oe_stat_button" icon="fa-truck"
                                invisible="not transit_order_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Ordre de</span>
                                <span class="o_stat_text">Transit</span>
                            </div>
                        </button>
                        <button name="action_view_payment_requests" type="object" 
                                class="oe_stat_button" icon="fa-credit-card"
                                invisible="not payment_request_avant_vente_id and not payment_request_apres_vente_id">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Demandes</span>
                                <span class="o_stat_text">Paiement</span>
                            </div>
                        </button>
                        <button class="oe_stat_button" icon="fa-pie-chart" disabled="1"
                                invisible="state == 'draft'">
                            <div class="o_stat_info">
                                <field name="paiement_progress" class="o_stat_value" widget="statinfo"/>
                                <span class="o_stat_text">% Pay√©</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Alertes visuelles am√©lior√©es -->
                    <div class="alert alert-light border-primary mb-3" role="alert" 
                         invisible="state != 'validated'">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-info-circle fa-2x text-primary me-3"/> 
                            <div>
                                <strong class="text-primary">Formule valid√©e - Pr√™te pour paiement</strong>
                                <p class="mb-0 mt-1">
                                    Montant avant-vente (60%): <strong><field name="montant_avant_vente"/> FCFA</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-warning mb-3" role="alert" 
                         invisible="state != 'partial_paid'">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-clock-o fa-2x text-warning me-3"/> 
                            <div>
                                <strong>Avant-vente pay√© ‚úì</strong> - En attente du paiement apr√®s-vente
                                <p class="mb-0 mt-1">
                                    Reste √† payer (40%): <strong><field name="montant_apres_vente"/> FCFA</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-success mb-3" role="alert" 
                         invisible="state != 'paid'">
                        <div class="d-flex align-items-center">
                            <i class="fa fa-check-circle fa-2x text-success me-3"/> 
                            <div>
                                <strong>Formule enti√®rement pay√©e !</strong>
                                <p class="mb-0 mt-1">
                                    Total pay√©: <strong><field name="total_paye"/> FCFA</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <widget name="web_ribbon" title="Valid√©e" bg_color="bg-primary" 
                            invisible="state != 'validated'"/>
                    <widget name="web_ribbon" title="Partiellement pay√©e" bg_color="bg-warning" 
                            invisible="state != 'partial_paid'"/>
                    <widget name="web_ribbon" title="Enti√®rement pay√©e" bg_color="bg-success" 
                            invisible="state != 'paid'"/>
                    <widget name="web_ribbon" title="Annul√©e" bg_color="bg-secondary" 
                            invisible="state != 'cancelled'"/>
                    
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="name" readonly="1" class="text-primary"/>
                        </h1>
                        <div class="o_row" invisible="not numero_fo1">
                            <label for="numero_fo1" class="fw-bold"/>
                            <field name="numero_fo1" readonly="state != 'draft'" class="fw-bold text-info"/>
                        </div>
                    </div>
                    
                    <group col="2">
                        <group string="üìã R√©f√©rences FO1">
                            <field name="company_id" invisible="1"/>
                            <field name="reference_ccc" placeholder="FO1/F025/327/0020/0084/0084"
                                   readonly="state != 'draft'" class="fw-bold"/>
                            <field name="numero_fo1" placeholder="22-3276"
                                   readonly="state != 'draft'"
                                   decoration-info="numero_fo1"/>
                            <field name="date_fo1" readonly="state != 'draft'"/>
                            <field name="nomenclature_douaniere" readonly="state != 'draft'"
                                   placeholder="1802 00 00 00"/>
                        </group>
                        <group string="üìÑ Rattachements">
                            <field name="confirmation_vente_id" 
                                   options="{'no_create': True, 'no_open': False}"
                                   readonly="state != 'draft'"
                                   class="fw-bold"/>
                            <field name="campaign_id" readonly="1" class="text-muted"/>
                            <field name="transit_order_id" 
                                   options="{'no_create': True}"
                                   readonly="state not in ('draft', 'validated')"
                                   decoration-success="transit_order_id"/>
                        </group>
                    </group>
                    
                    <group col="2">
                        <group string="üå± Produit">
                            <field name="date_emission" readonly="state != 'draft'"/>
                            <field name="date_validite" readonly="state != 'draft'"/>
                            <field name="product_type" readonly="state != 'draft'"
                                   widget="radio" options="{'horizontal': true}"/>
                            <field name="grade" readonly="state != 'draft'" widget="selection"/>
                        </group>
                        <group string="üìä Tonnage">
                            <field name="currency_id" 
                                   options="{'no_create': True}"
                                   readonly="state != 'draft'"
                                   groups="base.group_multi_currency"/>
                            <field name="tonnage" readonly="state != 'draft'" 
                                   class="fw-bold fs-5 text-primary"/>
                            <field name="tonnage_kg" readonly="1" class="text-muted"/>
                            <field name="tonnage_converti" readonly="state != 'draft'" optional="show"/>
                            <field name="tonnage_brut" readonly="state != 'draft'" optional="hide"/>
                            <field name="coefficient_conversion" readonly="state != 'draft'" optional="hide"/>
                        </group>
                    </group>
                    
                    <group col="2">
                        <group string="üí∞ Prix">
                            <field name="prix_kg" readonly="state != 'draft'" 
                                   placeholder="3 300 FCFA/Kg" class="fw-bold"/>
                            <field name="prix_reference" readonly="state != 'draft'"
                                   placeholder="3 929,751 FCFA/Kg" optional="show"/>
                            <field name="prix_tonnage" readonly="state != 'draft'"/>
                            <label for="taux_change"/>
                            <div class="o_row">
                                <field name="taux_change" readonly="state != 'draft'" class="oe_inline"/>
                                <span class="text-muted">USD/XOF</span>
                            </div>
                            <field name="currency_usd_id" invisible="1"/>
                            <field name="prix_tonnage_usd" readonly="state != 'draft'" optional="hide"/>
                        </group>
                        <group string="üì¶ Conditionnement">
                            <field name="emballage_type" readonly="state != 'draft'"/>
                            <field name="nombre_conteneurs" readonly="state != 'draft'"/>
                            <field name="type_transit" readonly="state != 'draft'"/>
                        </group>
                    </group>
                    
                    <group col="2">
                        <group string="üìà Diff√©rentiel qualit√©">
                            <field name="differentiel_type" readonly="state != 'draft'"
                                   widget="radio" options="{'horizontal': true}"/>
                            <field name="differentiel_qualite" readonly="state != 'draft'"
                                   invisible="differentiel_type == 'neutre'"
                                   class="fw-bold"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="üö¢ Contrat et Exp√©dition" name="contract_shipping">
                            <group>
                                <group string="Contrat Commercial">
                                    <field name="numero_contrat" readonly="state != 'draft'"
                                           placeholder="EIFC-TC012/25"/>
                                    <field name="numero_contrat_detail" readonly="state != 'draft'"
                                           placeholder="327-21416"/>
                                    <field name="date_contrat" readonly="state != 'draft'"/>
                                    <field name="confirmation_vente_numero" readonly="state != 'draft'"
                                           placeholder="327-21553"/>
                                    <field name="date_confirmation_vente" readonly="state != 'draft'"/>
                                </group>
                                <group string="Transitaire et Navire">
                                    <field name="transitaire_id" readonly="state != 'draft'"
                                           options="{'no_create': True}"/>
                                    <field name="navire" readonly="state != 'draft'"
                                           placeholder="MSC SORAYA"/>
                                </group>
                            </group>
                            <group>
                                <group string="Exportateur et Destinataire">
                                    <field name="exportateur" readonly="state != 'draft'"/>
                                    <field name="destinataire_nom" readonly="state != 'draft'"/>
                                    <field name="destinataire_adresse" readonly="state != 'draft'"/>
                                </group>
                                <group string="Destination et Ports">
                                    <field name="destination_country_id" readonly="state != 'draft'"/>
                                    <field name="destination_code" readonly="state != 'draft'"
                                           placeholder="Egypt AF1"/>
                                    <field name="port_destination" readonly="state != 'draft'"
                                           placeholder="Alexandrie"/>
                                    <field name="port_embarquement" readonly="state != 'draft'"/>
                                </group>
                            </group>
                            <group>
                                <group string="P√©riode d'embarquement">
                                    <field name="periode_embarquement_debut" readonly="state != 'draft'"/>
                                    <field name="periode_embarquement_fin" readonly="state != 'draft'"/>
                                    <field name="periode_embarquement_display" readonly="1" class="fw-bold"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="üí∞ Montants" name="amounts">
                            <group>
                                <group string="Calcul des montants">
                                    <field name="montant_brut" readonly="1"/>
                                    <field name="montant_total" readonly="1"/>
                                    <field name="total_taxes_prelevees" readonly="1" class="text-danger"/>
                                    <field name="montant_net" readonly="1" class="fw-bold text-success"/>
                                </group>
                                <group string="R√©partition paiements">
                                    <label for="pourcentage_avant_vente"/>
                                    <div class="o_row">
                                        <field name="pourcentage_avant_vente" class="oe_inline"
                                               readonly="state not in ('draft', 'validated')"/>
                                        <span>%</span>
                                    </div>
                                    <field name="montant_avant_vente" readonly="1"/>
                                    <label for="pourcentage_apres_vente"/>
                                    <div class="o_row">
                                        <field name="pourcentage_apres_vente" class="oe_inline" readonly="1"/>
                                        <span>%</span>
                                    </div>
                                    <field name="montant_apres_vente" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="üèõÔ∏è Taxes &amp; Redevances" name="taxes">
                            <field name="taxe_ids" readonly="state not in ('draft', 'validated')">
                                <tree string="Taxes et Redevances" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="taxe_type_id" options="{'no_create': True}"
                                           placeholder="Type pr√©d√©fini..."/>
                                    <field name="categorie" optional="show"/>
                                    <field name="code"/>
                                    <field name="name"/>
                                    <field name="taux_par_kg" string="Taux/Kg" optional="show"/>
                                    <field name="taux_pourcentage" string="Taux %" optional="show"/>
                                    <field name="montant_unitaire" optional="hide"/>
                                    <field name="montant_fixe" optional="show"/>
                                    <field name="montant" sum="Total" class="fw-bold"/>
                                    <field name="is_preleve" widget="boolean_toggle"/>
                                    <field name="date_prelevement" invisible="not is_preleve"/>
                                    <field name="numero_cheque" optional="show"/>
                                    <field name="date_paiement" optional="show"/>
                                    <field name="banque_name" optional="show"/>
                                    <field name="note" optional="hide"/>
                                    <field name="currency_id" column_invisible="1"/>
                                </tree>
                            </field>
                            <group class="mt-3">
                                <group>
                                    <field name="total_taxes_prelevees" readonly="1" 
                                           string="Total taxes pr√©lev√©es (d√©duites)"
                                           class="text-success fw-bold"/>
                                </group>
                                <group>
                                    <field name="total_taxes_a_payer" readonly="1" 
                                           string="Total taxes √† payer (par ch√®que)"
                                           class="text-warning fw-bold"/>
                                </group>
                            </group>
                            <div class="alert alert-info mt-3" role="alert">
                                <i class="fa fa-info-circle"/> 
                                <strong>Types de taxes CCC:</strong>
                                <ul class="mb-0">
                                    <li><b>Redevances</b> (taux/kg): Conseil Caf√©-Cacao (1,245), Investissement agricole (0,36), FIMR (0,386), Sacherie (0,27)</li>
                                    <li><b>Taxes</b> (% du montant): Taxe d'enregistrement (5%), DIUS (14,6%)</li>
                                    <li><b>Soutien/Reversement</b>: Montant revers√© aux producteurs</li>
                                </ul>
                            </div>
                        </page>
                        
                        <page string="üí≥ Paiements" name="payments">
                            <!-- Dashboard paiement visuel -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="alert alert-light border p-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="fw-bold">Progression du paiement</span>
                                            <span class="badge bg-primary fs-6">
                                                <field name="paiement_progress"/>%
                                            </span>
                                        </div>
                                        <field name="paiement_progress" widget="progressbar" 
                                               options="{'editable': false}" class="w-100"/>
                                    </div>
                                </div>
                            </div>
                            
                            <group col="2">
                                <group string="üü¢ Paiement Avant-vente (60%)">
                                    <div role="status"
                                         t-attf-class="alert mb-2 #{avant_vente_paye and 'alert-success' or 'alert-secondary'}">
                                        <field name="avant_vente_paye" invisible="1"/>
                                        <span invisible="not avant_vente_paye">
                                            <i class="fa fa-check-circle text-success"/> Pay√©
                                        </span>
                                        <span invisible="avant_vente_paye">
                                            <i class="fa fa-clock-o"/> En attente
                                        </span>
                                    </div>
                                    <field name="montant_avant_vente" readonly="1" 
                                           class="fw-bold fs-5 text-success"/>
                                    <field name="date_paiement_avant_vente_prevue"
                                           string="Date pr√©vue"/>
                                    <field name="date_paiement_avant_vente" readonly="1"
                                           invisible="not avant_vente_paye"
                                           string="Date effective"/>
                                    <field name="payment_request_avant_vente_id" readonly="1"
                                           invisible="not payment_request_avant_vente_id"
                                           string="Demande associ√©e"/>
                                </group>
                                <group string="üü° Paiement Apr√®s-vente (40%)">
                                    <div role="status"
                                         t-attf-class="alert mb-2 #{apres_vente_paye and 'alert-success' or 'alert-secondary'}">
                                        <field name="apres_vente_paye" invisible="1"/>
                                        <span invisible="not apres_vente_paye">
                                            <i class="fa fa-check-circle text-success"/> Pay√©
                                        </span>
                                        <span invisible="apres_vente_paye">
                                            <i class="fa fa-clock-o"/> En attente
                                        </span>
                                    </div>
                                    <field name="montant_apres_vente" readonly="1" 
                                           class="fw-bold fs-5 text-warning"/>
                                    <field name="date_paiement_apres_vente_prevue"
                                           string="Date pr√©vue"/>
                                    <field name="date_paiement_apres_vente" readonly="1"
                                           invisible="not apres_vente_paye"
                                           string="Date effective"/>
                                    <field name="payment_request_apres_vente_id" readonly="1"
                                           invisible="not payment_request_apres_vente_id"
                                           string="Demande associ√©e"/>
                                </group>
                            </group>
                            
                            <!-- R√©sum√© -->
                            <group string="üìä R√©sum√© des paiements" class="mt-4">
                                <group col="3">
                                    <field name="total_paye" readonly="1" 
                                           class="text-success fw-bold fs-4"
                                           string="Total pay√©"/>
                                    <field name="reste_a_payer" readonly="1" 
                                           decoration-danger="reste_a_payer > 0"
                                           decoration-success="reste_a_payer == 0"
                                           class="fw-bold fs-4"
                                           string="Reste √† payer"/>
                                    <field name="montant_net" readonly="1"
                                           string="Montant total formule"
                                           class="text-primary fw-bold"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="üìù Notes" name="notes">
                            <field name="note" placeholder="Notes et observations..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="potting_formule_view_search" model="ir.ui.view">
        <field name="name">potting.formule.search</field>
        <field name="model">potting.formule</field>
        <field name="arch" type="xml">
            <search string="Rechercher Formules">
                <field name="name"/>
                <field name="reference_ccc"/>
                <field name="numero_fo1"/>
                <field name="numero_contrat"/>
                <field name="confirmation_vente_id"/>
                <field name="transit_order_id"/>
                <field name="campaign_id"/>
                <field name="navire"/>
                <field name="destinataire_nom"/>
                <separator/>
                <filter string="Brouillon" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Valid√©es" name="validated" domain="[('state', '=', 'validated')]"/>
                <filter string="Partiellement pay√©es" name="partial_paid" domain="[('state', '=', 'partial_paid')]"/>
                <filter string="Pay√©es" name="paid" domain="[('state', '=', 'paid')]"/>
                <separator/>
                <filter string="Sans OT" name="no_ot" domain="[('transit_order_id', '=', False)]"/>
                <filter string="Avec OT" name="has_ot" domain="[('transit_order_id', '!=', False)]"/>
                <separator/>
                <filter string="Avant-vente non pay√©" name="avant_vente_pending" 
                        domain="[('avant_vente_paye', '=', False), ('state', 'in', ('validated', 'partial_paid'))]"/>
                <filter string="Apr√®s-vente non pay√©" name="apres_vente_pending" 
                        domain="[('apres_vente_paye', '=', False), ('avant_vente_paye', '=', True)]"/>
                <separator/>
                <filter string="Port San Pedro" name="san_pedro" domain="[('port_embarquement', '=', 'san_pedro')]"/>
                <filter string="Port Abidjan" name="abidjan" domain="[('port_embarquement', '=', 'abidjan')]"/>
                <separator/>
                <filter string="Ma soci√©t√©" name="my_company" 
                        domain="[('company_id', '=', context.get('allowed_company_ids', [False])[0])]"/>
                <group expand="0" string="Grouper par">
                    <filter string="√âtat" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="CV" name="group_cv" context="{'group_by': 'confirmation_vente_id'}"/>
                    <filter string="Campagne" name="group_campaign" context="{'group_by': 'campaign_id'}"/>
                    <filter string="Type produit" name="group_product" context="{'group_by': 'product_type'}"/>
                    <filter string="Grade" name="group_grade" context="{'group_by': 'grade'}"/>
                    <filter string="Port" name="group_port" context="{'group_by': 'port_embarquement'}"/>
                    <filter string="Pays destination" name="group_destination" context="{'group_by': 'destination_country_id'}"/>
                    <filter string="Transitaire" name="group_transitaire" context="{'group_by': 'transitaire_id'}"/>
                    <filter string="Date √©mission" name="group_date" context="{'group_by': 'date_emission:month'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban View -->
    <record id="potting_formule_view_kanban" model="ir.ui.view">
        <field name="name">potting.formule.kanban</field>
        <field name="model">potting.formule</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" sample="1" default_group_by="state">
                <field name="name"/>
                <field name="reference_ccc"/>
                <field name="confirmation_vente_id"/>
                <field name="transit_order_id"/>
                <field name="tonnage"/>
                <field name="prix_tonnage"/>
                <field name="montant_net"/>
                <field name="currency_id"/>
                <field name="total_paye"/>
                <field name="paiement_progress"/>
                <field name="avant_vente_paye"/>
                <field name="apres_vente_paye"/>
                <field name="state"/>
                <progressbar field="state" 
                             colors='{"draft": "secondary", "validated": "primary", "partial_paid": "warning", "paid": "success", "cancelled": "muted"}'/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top mb-2">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <span t-if="record.reference_ccc.raw_value" 
                                              class="text-muted ms-2">
                                            (<field name="reference_ccc"/>)
                                        </span>
                                    </div>
                                    <field name="state" widget="label_selection" 
                                           options="{'classes': {'draft': 'secondary', 'validated': 'primary', 'partial_paid': 'warning', 'paid': 'success', 'cancelled': 'dark'}}"/>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="mb-1">
                                        <i class="fa fa-certificate text-muted"/> CV: 
                                        <field name="confirmation_vente_id"/>
                                    </div>
                                    <div t-if="record.transit_order_id.raw_value" class="mb-1">
                                        <i class="fa fa-truck text-muted"/> OT: 
                                        <field name="transit_order_id"/>
                                    </div>
                                    <div class="mb-1">
                                        <i class="fa fa-balance-scale text-muted"/> 
                                        <field name="tonnage"/> T √ó 
                                        <field name="prix_tonnage" widget="monetary"/>
                                    </div>
                                    <div class="mb-1 fw-bold">
                                        <i class="fa fa-money text-success"/> Net: 
                                        <field name="montant_net" widget="monetary"/>
                                    </div>
                                    <div class="mb-2">
                                        <field name="paiement_progress" widget="progressbar" 
                                               options="{'editable': false}"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom mt-2">
                                    <div class="oe_kanban_bottom_left">
                                        <span t-if="record.avant_vente_paye.raw_value" 
                                              class="badge bg-success me-1">
                                            <i class="fa fa-check"/> Avant-vente
                                        </span>
                                        <span t-else="" class="badge bg-secondary me-1">
                                            <i class="fa fa-clock-o"/> Avant-vente
                                        </span>
                                        <span t-if="record.apres_vente_paye.raw_value" 
                                              class="badge bg-success">
                                            <i class="fa fa-check"/> Apr√®s-vente
                                        </span>
                                        <span t-else="" class="badge bg-secondary">
                                            <i class="fa fa-clock-o"/> Apr√®s-vente
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="potting_formule_view_pivot" model="ir.ui.view">
        <field name="name">potting.formule.pivot</field>
        <field name="model">potting.formule</field>
        <field name="arch" type="xml">
            <pivot string="Analyse Formules" sample="1">
                <field name="confirmation_vente_id" type="row"/>
                <field name="state" type="col"/>
                <field name="tonnage" type="measure"/>
                <field name="montant_net" type="measure"/>
                <field name="total_paye" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View -->
    <record id="potting_formule_view_graph" model="ir.ui.view">
        <field name="name">potting.formule.graph</field>
        <field name="model">potting.formule</field>
        <field name="arch" type="xml">
            <graph string="Formules" type="bar" sample="1">
                <field name="confirmation_vente_id"/>
                <field name="montant_net" type="measure"/>
                <field name="total_paye" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_potting_formule" model="ir.actions.act_window">
        <field name="name">Formules</field>
        <field name="res_model">potting.formule</field>
        <field name="view_mode">tree,kanban,form,pivot,graph</field>
        <field name="search_view_id" ref="potting_formule_view_search"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Cr√©ez votre premi√®re Formule (FO)
            </p>
            <p>
                Les Formules d√©finissent le prix et les conditions de paiement 
                pour les producteurs de cacao. Elles sont li√©es aux Confirmations 
                de Vente et peuvent √™tre attach√©es aux Ordres de Transit.
            </p>
        </field>
    </record>

    <!-- ====================================================================
         TAXE SUR FORMULE - VUES
         ==================================================================== -->
    
    <!-- Tree View for Taxes (standalone) -->
    <record id="potting_formule_taxe_view_tree" model="ir.ui.view">
        <field name="name">potting.formule.taxe.tree</field>
        <field name="model">potting.formule.taxe</field>
        <field name="arch" type="xml">
            <tree string="Taxes sur Formules">
                <field name="formule_id"/>
                <field name="categorie"/>
                <field name="code"/>
                <field name="name"/>
                <field name="taux_par_kg"/>
                <field name="taux_pourcentage"/>
                <field name="montant" sum="Total"/>
                <field name="is_preleve" widget="boolean_toggle"/>
                <field name="numero_cheque"/>
                <field name="date_paiement"/>
                <field name="banque_name"/>
            </tree>
        </field>
    </record>
    
    <!-- ====================================================================
         TYPE DE TAXE CCC - VUES
         ==================================================================== -->
    
    <!-- Tree View -->
    <record id="potting_taxe_type_view_tree" model="ir.ui.view">
        <field name="name">potting.taxe.type.tree</field>
        <field name="model">potting.taxe.type</field>
        <field name="arch" type="xml">
            <tree string="Types de Taxes CCC" editable="bottom">
                <field name="sequence" widget="handle"/>
                <field name="code"/>
                <field name="name"/>
                <field name="categorie"/>
                <field name="taux_par_kg" string="Taux/Kg"/>
                <field name="taux_pourcentage" string="Taux %"/>
                <field name="is_preleve_default"/>
                <field name="active"/>
            </tree>
        </field>
    </record>
    
    <!-- Form View -->
    <record id="potting_taxe_type_view_form" model="ir.ui.view">
        <field name="name">potting.taxe.type.form</field>
        <field name="model">potting.taxe.type</field>
        <field name="arch" type="xml">
            <form string="Type de Taxe CCC">
                <sheet>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="name" placeholder="Nom de la taxe"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Identification">
                            <field name="code" placeholder="CCC, FIMR, DIUS..."/>
                            <field name="categorie"/>
                            <field name="sequence"/>
                            <field name="active"/>
                        </group>
                        <group string="Taux par d√©faut">
                            <field name="taux_par_kg" 
                                   invisible="categorie == 'taxe'"
                                   placeholder="1.245"/>
                            <field name="taux_pourcentage" 
                                   invisible="categorie == 'redevance'"
                                   placeholder="5.0"/>
                            <field name="is_preleve_default"/>
                        </group>
                    </group>
                    <group>
                        <field name="description" placeholder="Description d√©taill√©e..."/>
                    </group>
                    <field name="company_id" invisible="1"/>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Search View -->
    <record id="potting_taxe_type_view_search" model="ir.ui.view">
        <field name="name">potting.taxe.type.search</field>
        <field name="model">potting.taxe.type</field>
        <field name="arch" type="xml">
            <search string="Rechercher Types de Taxes">
                <field name="name"/>
                <field name="code"/>
                <separator/>
                <filter string="Redevances" name="redevance" domain="[('categorie', '=', 'redevance')]"/>
                <filter string="Taxes" name="taxe" domain="[('categorie', '=', 'taxe')]"/>
                <filter string="Soutien" name="soutien" domain="[('categorie', '=', 'soutien')]"/>
                <separator/>
                <filter string="Archiv√©s" name="archived" domain="[('active', '=', False)]"/>
                <group expand="0" string="Grouper par">
                    <filter string="Cat√©gorie" name="group_categorie" context="{'group_by': 'categorie'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Action -->
    <record id="action_potting_taxe_type" model="ir.actions.act_window">
        <field name="name">Types de Taxes CCC</field>
        <field name="res_model">potting.taxe.type</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="potting_taxe_type_view_search"/>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                D√©finir les types de taxes CCC
            </p>
            <p>
                Configurez les types de taxes et redevances du Conseil Caf√©-Cacao
                avec leurs taux par d√©faut pour faciliter la saisie des formules.
            </p>
        </field>
    </record>

</odoo>
