<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View for Consignees -->
    <record id="potting_consignee_view_tree" model="ir.ui.view">
        <field name="name">res.partner.consignee.tree</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <tree string="Destinataires (Consignees)" editable="bottom">
                <field name="potting_consignee_code" optional="show"/>
                <field name="name" string="Nom du destinataire"/>
                <field name="email" optional="show"/>
                <field name="phone" optional="show"/>
                <field name="city" optional="show"/>
                <field name="country_id" optional="show"/>
                <field name="potting_transit_order_count" string="OT"/>
                <field name="is_potting_consignee" column_invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Form View for Consignees -->
    <record id="potting_consignee_view_form" model="ir.ui.view">
        <field name="name">res.partner.consignee.form</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <form string="Destinataire (Consignee)">
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_potting_transit_orders" type="object" 
                                class="oe_stat_button" icon="fa-truck"
                                invisible="potting_transit_order_count == 0">
                            <field name="potting_transit_order_count" widget="statinfo" string="Ordres de Transit"/>
                        </button>
                    </div>
                    <widget name="web_ribbon" title="Destinataire" bg_color="bg-info"/>
                    <field name="image_1920" widget="image" class="oe_avatar" options="{'preview_image': 'image_128'}"/>
                    <div class="oe_title">
                        <label for="name" string="Nom du destinataire"/>
                        <h1>
                            <field name="name" placeholder="Nom du destinataire..." class="text-primary"/>
                        </h1>
                    </div>
                    <group>
                        <group string="ğŸ“‹ Informations">
                            <field name="is_potting_consignee" invisible="1"/>
                            <field name="potting_consignee_code" placeholder="Code unique..."/>
                            <field name="company_type" invisible="1"/>
                            <field name="is_company" invisible="1"/>
                            <field name="parent_id" string="SociÃ©tÃ© mÃ¨re" 
                                   domain="[('is_company', '=', True)]"
                                   context="{'default_is_company': True}"/>
                        </group>
                        <group string="ğŸ“ Adresse">
                            <field name="street" placeholder="Rue..."/>
                            <field name="street2" placeholder="ComplÃ©ment..."/>
                            <field name="zip" placeholder="Code postal..."/>
                            <field name="city" placeholder="Ville..."/>
                            <field name="state_id" placeholder="RÃ©gion..." 
                                   domain="[('country_id', '=', country_id)]"/>
                            <field name="country_id" placeholder="Pays..."/>
                        </group>
                    </group>
                    <group>
                        <group string="ğŸ“ Contact">
                            <field name="phone" placeholder="TÃ©lÃ©phone..." widget="phone"/>
                            <field name="mobile" placeholder="Mobile..." widget="phone"/>
                            <field name="email" placeholder="Email..." widget="email"/>
                            <field name="website" placeholder="Site web..." widget="url"/>
                        </group>
                        <group string="ğŸ’¼ Informations commerciales">
                            <field name="vat" placeholder="NumÃ©ro TVA..."/>
                            <field name="ref" placeholder="RÃ©fÃ©rence interne..."/>
                            <field name="lang" placeholder="Langue..."/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Notes" name="notes">
                            <field name="comment" placeholder="Notes sur ce destinataire..."/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View for Consignees -->
    <record id="potting_consignee_view_search" model="ir.ui.view">
        <field name="name">res.partner.consignee.search</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <search string="Rechercher destinataires">
                <field name="name" filter_domain="['|', '|', ('name', 'ilike', self), ('potting_consignee_code', 'ilike', self), ('email', 'ilike', self)]"/>
                <field name="potting_consignee_code"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="city"/>
                <field name="country_id"/>
                <group expand="0" string="Grouper par">
                    <filter string="Pays" name="country" context="{'group_by': 'country_id'}"/>
                    <filter string="Ville" name="city" context="{'group_by': 'city'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Kanban View for Consignees -->
    <record id="potting_consignee_view_kanban" model="ir.ui.view">
        <field name="name">res.partner.consignee.kanban</field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="name"/>
                <field name="potting_consignee_code"/>
                <field name="email"/>
                <field name="phone"/>
                <field name="city"/>
                <field name="country_id"/>
                <field name="image_128"/>
                <field name="potting_transit_order_count"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click o_kanban_record_has_image_fill">
                            <div class="o_kanban_image_fill_left d-none d-md-block" 
                                 t-attf-style="background-image: url('#{kanban_image('res.partner', 'image_128', record.id.raw_value)}')"/>
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top mb-2">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <i class="fa fa-user-circle me-1 text-info"/> <field name="name"/>
                                        </strong>
                                        <small t-if="record.potting_consignee_code.raw_value" class="text-muted ms-2">
                                            [<field name="potting_consignee_code"/>]
                                        </small>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div t-if="record.email.raw_value" class="mb-1">
                                        <i class="fa fa-envelope text-muted me-1"/> <field name="email"/>
                                    </div>
                                    <div t-if="record.phone.raw_value" class="mb-1">
                                        <i class="fa fa-phone text-muted me-1"/> <field name="phone"/>
                                    </div>
                                    <div t-if="record.city.raw_value" class="mb-1">
                                        <i class="fa fa-map-marker text-muted me-1"/> 
                                        <field name="city"/><t t-if="record.country_id.raw_value">, <field name="country_id"/></t>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom mt-2">
                                    <div class="oe_kanban_bottom_left">
                                        <span t-if="record.potting_transit_order_count.raw_value > 0" class="badge text-bg-primary rounded-pill">
                                            <i class="fa fa-truck me-1"/><t t-out="record.potting_transit_order_count.raw_value"/> OT
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Action for Consignees -->
    <record id="action_potting_consignee" model="ir.actions.act_window">
        <field name="name">Destinataires (Consignees)</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="domain">[('is_potting_consignee', '=', True)]</field>
        <field name="context">{'default_is_potting_consignee': True, 'default_is_company': True}</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('potting_consignee_view_tree')}),
            (0, 0, {'view_mode': 'kanban', 'view_id': ref('potting_consignee_view_kanban')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('potting_consignee_view_form')})]"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                CrÃ©er un nouveau destinataire (Consignee)
            </p>
            <p>
                Les destinataires sont les contacts vers lesquels les produits sont expÃ©diÃ©s via les Ordres de Transit.
            </p>
        </field>
    </record>
</odoo>
