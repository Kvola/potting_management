<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Import Contracts Wizard Form View -->
        <record id="potting_import_contracts_wizard_view_form" model="ir.ui.view">
            <field name="name">potting.import.contracts.wizard.form</field>
            <field name="model">potting.import.contracts.wizard</field>
            <field name="arch" type="xml">
                <form string="Import de contrats Excel">
                    <header>
                        <button name="action_parse_file" 
                                string="üìã Analyser le fichier" 
                                type="object" 
                                class="btn-primary"
                                invisible="state != 'upload'"/>
                        <button name="action_import" 
                                string="‚úÖ Importer les contrats valides" 
                                type="object" 
                                class="btn-success"
                                invisible="state != 'preview' or valid_lines == 0"/>
                        <button name="action_view_orders" 
                                string="üìÇ Voir les contrats cr√©√©s" 
                                type="object" 
                                class="btn-primary"
                                invisible="state != 'done'"/>
                        <field name="state" widget="statusbar" statusbar_visible="upload,preview,done"/>
                    </header>
                    <sheet>
                        <!-- Upload State -->
                        <div invisible="state != 'upload'">
                            <div class="alert alert-info" role="alert">
                                <h4 class="alert-heading">
                                    <i class="fa fa-info-circle"/> Import de contrats depuis Excel
                                </h4>
                                <p>
                                    Cet assistant vous permet d'importer des contrats (commandes clients) 
                                    depuis un fichier Excel (.xlsx).
                                </p>
                                <hr/>
                                <p class="mb-0">
                                    <strong>√âtape 1:</strong> T√©l√©chargez le mod√®le Excel ci-dessous.<br/>
                                    <strong>√âtape 2:</strong> Remplissez le fichier avec vos donn√©es.<br/>
                                    <strong>√âtape 3:</strong> T√©l√©versez le fichier compl√©t√©.<br/>
                                    <strong>√âtape 4:</strong> V√©rifiez l'aper√ßu et importez.
                                </p>
                            </div>
                            
                            <group>
                                <group string="üì• T√©l√©charger le mod√®le">
                                    <div colspan="2">
                                        <button name="action_download_template" 
                                                string="‚¨áÔ∏è T√©l√©charger le mod√®le Excel" 
                                                type="object" 
                                                class="btn-primary mb-3"
                                                icon="fa-download"/>
                                        <p class="text-muted">
                                            Le mod√®le contient des exemples de donn√©es et des instructions.
                                        </p>
                                    </div>
                                </group>
                                <group string="üì§ T√©l√©verser votre fichier">
                                    <field name="file_data" filename="file_name"/>
                                    <field name="file_name" invisible="1"/>
                                </group>
                            </group>
                        </div>
                        
                        <!-- Preview State -->
                        <div invisible="state != 'preview'">
                            <div class="alert alert-success" role="status" invisible="error_lines > 0">
                                <i class="fa fa-check-circle"/> 
                                Toutes les <strong><field name="total_lines" nolabel="1"/></strong> lignes sont valides et pr√™tes √† √™tre import√©es.
                            </div>
                            <div class="alert alert-warning" role="status" invisible="error_lines == 0">
                                <i class="fa fa-exclamation-triangle"/> 
                                <strong><field name="valid_lines" nolabel="1"/></strong> ligne(s) valide(s) sur 
                                <strong><field name="total_lines" nolabel="1"/></strong>.
                                <strong><field name="error_lines" nolabel="1"/></strong> ligne(s) en erreur (voir d√©tails ci-dessous).
                            </div>
                            
                            <notebook>
                                <page string="üìã Aper√ßu des donn√©es" name="preview">
                                    <field name="preview_line_ids" nolabel="1">
                                        <tree decoration-danger="not is_valid" 
                                              decoration-success="is_valid"
                                              editable="bottom">
                                            <field name="row_number" string="#"/>
                                            <field name="is_valid" widget="boolean_toggle" readonly="1"/>
                                            <field name="contract_number"/>
                                            <field name="customer_name"/>
                                            <field name="customer_id"/>
                                            <field name="product_type"/>
                                            <field name="tonnage"/>
                                            <field name="unit_price"/>
                                            <field name="currency_id"/>
                                            <field name="date_order"/>
                                            <field name="error_message" string="Erreurs" 
                                                   widget="text" 
                                                   column_invisible="True"/>
                                        </tree>
                                    </field>
                                </page>
                                <page string="‚ö†Ô∏è Erreurs" name="errors" 
                                      invisible="error_lines == 0"
                                      badge="error_lines">
                                    <field name="preview_line_ids" 
                                           nolabel="1"
                                           domain="[('is_valid', '=', False)]">
                                        <tree decoration-danger="1">
                                            <field name="row_number" string="Ligne"/>
                                            <field name="contract_number"/>
                                            <field name="customer_name"/>
                                            <field name="error_message" string="Erreurs"/>
                                        </tree>
                                    </field>
                                </page>
                            </notebook>
                        </div>
                        
                        <!-- Done State -->
                        <div invisible="state != 'done'">
                            <div class="alert alert-success" role="status">
                                <h4 class="alert-heading">
                                    <i class="fa fa-check-circle"/> Import termin√© !
                                </h4>
                            </div>
                            <group>
                                <field name="import_result" readonly="1" nolabel="1" colspan="2"/>
                            </group>
                        </div>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Action to open the wizard -->
        <record id="action_potting_import_contracts_wizard" model="ir.actions.act_window">
            <field name="name">Importer des contrats (Excel)</field>
            <field name="res_model">potting.import.contracts.wizard</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="groups_id" eval="[(4, ref('potting_management.group_potting_shipping'))]"/>
        </record>

        <!-- Server Action for Menu -->
        <record id="action_server_import_contracts" model="ir.actions.server">
            <field name="name">Importer des contrats</field>
            <field name="model_id" ref="model_potting_customer_order"/>
            <field name="binding_model_id" ref="model_potting_customer_order"/>
            <field name="binding_view_types">list</field>
            <field name="groups_id" eval="[(4, ref('potting_management.group_potting_shipping'))]"/>
            <field name="state">code</field>
            <field name="code">
action = {
    'type': 'ir.actions.act_window',
    'name': 'Importer des contrats (Excel)',
    'res_model': 'potting.import.contracts.wizard',
    'view_mode': 'form',
    'target': 'new',
}
            </field>
        </record>

    </data>
</odoo>
